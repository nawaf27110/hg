<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ุฃุฎุชุจุงุฑ ูุงุฏุฉ ููุฒูุงุก 3-3</title>

  <!-- ุฑุจุท ููู CSS (ุงุฎุชูุงุฑู) -->
  <link rel="stylesheet" href="style.css">

  <!-- ููุชุจุฉ MathJax ูุนุฑุถ ุงููุนุงุฏูุงุช -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [["$","$"], ["\\(","\\)"]],
        displayMath: [["$$","$$"], ["\\[","\\]"]]
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

  <!-- ููุชุจุฉ html2pdf ุฅู ุงุญุชุฌุชูุง ูุงุญููุง (ุญุงูููุง ุบูุฑ ูุณุชุฎุฏูุฉ) -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

 <!-- ุชุญูู ูู ุงูููุฏ ูุงูุฅูููู ุนุจุฑ ุงุณุชุนูุงู ุงูุดูุช (sheetdata) -->
  <script>
    // ุงุฌูุจ ุงูููุฏ ูุงูุฅูููู ูู ุฑุงุจุท ุงูุตูุญุฉ
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");
    const email = params.get("email");

    if(!code || !email) {
      // ุฅุฐุง ูู ูุชููุฑ code ุฃู emailุ ุฅุนุงุฏุฉ ุชูุฌูู ูู check.html
      alert("๐ซ ูุง ููููู ุงูุฏุฎูู ุจุฏูู ููุฏ ูุจุฑูุฏ ุฅููุชุฑููู");
      window.location.href = "check.html";
    } else {
      console.log("ููุฏ ุงูุฏุฎูู =", code);
      console.log("ุงูุฅูููู =", email);

      // ูุชุญูู ูู ุงูุดูุช ุนุจุฑ ุฏุงูุฉ sheetdata ุงูููุฌูุฏุฉ ูุฏูู ุนูู ูุชูุงููู
      fetch('/.netlify/functions/sheetdata')
        .then(response => response.json())
        .then(data => {
          // ุงุจุญุซ ุนู ุตู ููู code ู email ูุทุงุจูุงู ูุง ุฌุงุก ูู ุงูุฑุงุจุท
          const match = data.find(row =>
            row.code?.trim() === code.trim() &&
            row.email?.trim().toLowerCase() === email.trim().toLowerCase()
          );

          if (!match) {
            // ูู ูุชู ุงูุนุซูุฑ ุนูู ูุทุงุจู
            alert("๐ซ ุงูุจูุงูุงุช ุบูุฑ ุตุญูุญุฉุ ุณูุชู ุฅุนุงุฏุชู ุฅูู ุตูุญุฉ ุงูุชุญูู.");
            window.location.href = "check.html";
          } else {
            // ุงูุฏุฎูู ูุณููุญ
            console.log("โ ุงูุฏุฎูู ูุณููุญ");
            // ุจุฅููุงูู ุฅุถุงูุฉ ุฃู ุฅุฌุฑุงุก ุฃู ุชุดุบูู ูุธุงุฆู ุฃุฎุฑู
            // ูุซู ุฅุธูุงุฑ ุงูุตูุญุฉ ุฃู ุฅุฒุงูุฉ ุงูุบุทุงุก ุนููุง
          }
        })
        .catch(error => {
          console.error("ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุฃู ูุฑุงุกุฉ ุงูุจูุงูุงุช:", error);
          alert("๐ซ ุญุฏุซ ุฎุทุฃุ ุญุงูู ูุงุญููุง.");
          window.location.href = "check.html";
        });
    }
  </script>

  <!-- 1) ุจูู ุงูุฃุณุฆูุฉ -->
  <script src="questionsDatabase.js"></script>

  <!-- 2) ููุฏ ุงูููุทู ุจุนุฏู -->
  <script src="script.js"></script>
</head>

<body>

  <!-- ุงูุตูุญุฉ ุงูุฃููู (ุจูุงูุงุช ุฃุณุงุณูุฉ) -->
  <div id="page1" class="container">
    <h3>ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ (ุฌููุนูุง ุญููู ุฅูุฒุงููุฉ)</h3>
    
    <!-- ุงุณู ุงููุนูู -->
    <label>ุงุณู ุงููุนูู:</label>
    <input type="text" id="teacherName" required placeholder="ูุซุงู: ุฃ. ููุงู ุงูุทูููุนู" oninput="saveFormState()">

    <!-- ุงูุนุงู ุงูุฏุฑุงุณู -->
    <label>ุงูุนุงู ุงูุฏุฑุงุณู:</label>
    <input type="text" id="academicYear" required placeholder="ูุซุงู: 1444" oninput="updateAcademicYear(); saveFormState();">

    <!-- ุฅุฏุงุฑุฉ ุงูุชุนููู -->
    <label>ุฅุฏุงุฑุฉ ุงูุชุนููู :</label>
    <input type="text" id="educationDepartment" required placeholder="ูุซุงู: ุฌุฏุฉ" oninput="updateEducationDepartment(); saveFormState();">

    <!-- ููุน ุงูุงุฎุชุจุงุฑ -->
    <label>ููุน ุงูุงุฎุชุจุงุฑ :</label>
    <select id="examType" required onchange="updateExamType(); saveFormState();">
      <option value="">ุงุฎุชุฑ ููุน ุงูุงุฎุชุจุงุฑ</option>
      <option value="ุงุฎุชุจุงุฑ ุงููุชุฑุฉ ุงูุงููู">ุงุฎุชุจุงุฑ ุงููุชุฑุฉ ุงูุงููู</option>
      <option value="ุงุฎุชุจุงุฑ ููุงุฆู">ุงุฎุชุจุงุฑ ููุงุฆู</option>
      <option value="ุฃุฎุชุจุงุฑ ูุตูุฑ">ุฃุฎุชุจุงุฑ ูุตูุฑ</option>
      <option value="ูุงุฌุจ">ูุงุฌุจ</option>
    </select>

    <!-- ุงูุฏุฑุฌุฉ ุงููููุฉ -->
    <label>ุงูุฏุฑุฌุฉ ุงููููุฉ :</label>
    <input type="number" id="manualTotalScore" required min="0" value="0" oninput="updateManualTotalScore(); saveFormState();">

    <!-- ุงุณู ุงููุฏุฑุณุฉ -->
    <label>ุงุณู ุงููุฏุฑุณุฉ :</label>
    <input type="text" id="schoolName" required placeholder="ูุซุงู: ุซุงูููุฉ ุงูููู ููุฏ" oninput="saveFormState()">

    <!-- ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูุงุฎุชูุงุฑ ุจููู/ุจูุงุช -->
    <label for="genderSelect">ุงุฎุชุฑ ุงูููุน:</label>
    <select id="genderSelect" onchange="toggleGenderMode()">
      <option value="boys" selected>ุจููู</option>
      <option value="girls">ุจูุงุช</option>
    </select>

    <button onclick="validateAndGoNext()">ุงูุชุงูู</button>
  </div>

  <!-- ุงูุตูุญุฉ ุงูุซุงููุฉ (Page 2) -->
  <div id="page2" class="container" style="display: none;">
    <!-- ุงุฎุชูุงุฑ ุงููุตู/ุงููุญุฏุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุช ุฌุงูุฒุฉ -->
    <label>ุงุฎุชุฑ ุงูููุถูุน (ุงููุตู):</label>
    <select id="subject" onchange="showSubtopics()">
      <option value="">ุงุฎุชุฑ ุงูููุถูุน</option>
      <option value="electromagnetic_induction">ุงููุตู ุงูุงูู ุงูุญุซ ุงูููุฑููุบูุงุทูุณู</option>
      <option value="electromagnetism">ุงููุตู ุงูุซุงูู ุงูููุฑููุบูุงุทูุณูุฉ</option>
      <option value="quantum_theory">ุงููุตู ุงูุซุงูุซ ูุธุฑูุฉ ุงููู</option>
      <option value="atomic_physics">ุงููุตู ุงูุฑุงุจุน ุงูุฐุฑุฉ</option>
      <option value="solid_state_electronics">ุงููุตู ุงูุฎุงูุณ ุงููุชุฑูููุงุช ุงูุญุงูุฉ ุงูุตูุจุฉ</option>
      <option value="nuclear_physics">ุงููุตู ุงูุณุงุฏุณ ุงูููุฒูุงุก ุงูููููุฉ</option>
    </select>

    <label id="subtopicLabel" style="display:none;">ุงุฎุชุฑ ุงููุณู ุงููุฑุนู:</label>
    <select id="subtopicSelect" style="display:none;" onchange="showQuestionsForSubtopic()">
      <option value="">ุงุฎุชุฑ ุงููุณู ุงููุฑุนู</option>
    </select>

    <!-- ุงููุณู ุงูุฌุฏูุฏ ูุนุฑุถ ูุงุฆูุฉ ุงูุฃุณุฆูุฉ -->
    <div id="questionList" style="
      display:none; 
      border:1px solid #ccc; 
      padding:10px; 
      min-height:120px; 
      max-height:400px; 
      overflow:auto; 
      width:100%;
    ">
      <p style="font-size:14px; color:#999; text-align:center;">ุงุฎุชุฑ ุณุคุงู ูุฅุถุงูุชู</p>
    </div>

    <hr style="margin: 20px 0;">

    <!-- ุงูุจุญุซ ูู ุฌููุน ุงูุฃุณุฆูุฉ (ูู ูุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช) -->
    <h4>ุงูุจุญุซ ูู ุฌููุน ุงูุฃุณุฆูุฉ (ูู ูุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช)</h4>
    <input type="text" id="searchQuestionsInput" placeholder="ุงูุชุจ ูููุงุช ุงูุจุญุซ..." oninput="searchAllQuestions()">
    <div id="searchResults" style="border:1px solid #ccc; padding:5px; min-height:120px; max-height:200px; overflow:auto;">
      <p style="font-size:14px; color:#999; text-align:center;">ุงูุชุจ ูููุงุช ุงูุจุญุซ ุฃุนูุงู</p>
    </div>

    <hr style="margin: 20px 0;">

    <!-- ุฅุถุงูุฉ ุณุคุงู ูุฎุตุต -->
    <h4>ุฅุถุงูุฉ ุณุคุงู ูุฎุตุต</h4>
    <select id="customQuestionType" onchange="handleCustomTypeChange()">
      <option value="">ุงุฎุชุฑ ููุน ุงูุณุคุงู</option>
      <option value="mcq">ุณุคุงู ุงุฎุชูุงุฑ ูุชุนุฏุฏ</option>
      <option value="tf">ุณุคุงู ุตุญ ูุฎุทุฃ</option>
      <option value="essay">ุณุคุงู ููุงูู/ูุณุฃูุฉ</option>
    </select>

    <div id="customFieldsContainer">
      <!-- MCQ Fields -->
      <div id="mcqFields" style="display:none; margin-top:10px;">
        <textarea id="mcqQuestionInput" rows="2" placeholder="ูุต ุงูุณุคุงู"></textarea>
        <input type="text" id="mcqOption1" placeholder="ุงูุฎูุงุฑ ุงูุฃูู">
        <input type="text" id="mcqOption2" placeholder="ุงูุฎูุงุฑ ุงูุซุงูู">
        <input type="text" id="mcqOption3" placeholder="ุงูุฎูุงุฑ ุงูุซุงูุซ">
        <input type="text" id="mcqOption4" placeholder="ุงูุฎูุงุฑ ุงูุฑุงุจุน">
      </div>

      <!-- TF Fields -->
      <div id="tfFields" style="display:none; margin-top:10px;">
        <textarea id="tfQuestionInput" rows="2" placeholder="ูุต ุงูุณุคุงู"></textarea>
      </div>

      <!-- Essay Fields -->
      <div id="essayFields" style="display:none; margin-top:10px;">
        <textarea id="essayQuestionInput" rows="4" placeholder="ูุต ุงูุณุคุงู ุงูููุงูู ุฃู ุงููุณุฃูุฉ"></textarea>
        <input type="file" id="essayImageInput" accept="image/*">
      </div>
    </div>

    <button onclick="addCustomQuestion()" style="display:none;" id="addCustomBtn">ุฃุถู ุงูุณุคุงู</button>

    <hr style="margin: 20px 0;">

    <!-- ุฒุฑ ุทุจุงุนุฉ -->
    <button onclick="printExam()">ูุนุงููุฉ ุงูุดูู ุงูููุงุฆู ููุฑูุฉ ุงูุงุฎุชุจุงุฑ - ุญูุธ PDF - ุทุจุงุนุฉ</button>

    <!-- ุฒุฑ ุงูุฑุฌูุน ููุตูุญุฉ ุงูุฃููู -->
    <button onclick="goBackToPage1()">ุฑุฌูุน</button>
  </div>

  <!-- ููุทูุฉ ุงููุนุงููุฉ ุงูููุงุฆูุฉ ููุงุฎุชุจุงุฑ -->
  <div id="examPreview">
    <img id="examLogo" class="exam-logo" src="https://i.imgur.com/gcGPjyB.png" alt="ุดุนุงุฑ ูุฒุงุฑุฉ ุงูุชุนููู">
    <div class="header">
      <p class="test-time" id="testTime"></p>
      <p>ุงูููููุฉ ุงูุนุฑุจูุฉ ุงูุณุนูุฏูุฉ</p>
      <p>ูุฒุงุฑุฉ ุงูุชุนููู</p>
      <p id="educationDepartmentHeader">ุฅุฏุงุฑุฉ ุงูุชุนููู ุจููุทูุฉ</p>
      <p id="schoolHeader">ุงุณู ุงููุฏุฑุณุฉ</p>
      <p class="student-name" id="studentHeader">ุงุณู ุงูุทุงูุจ: ____________________</p>
      <p class="seat-number" id="seatNumber" style="position: absolute; top: 85px; left: 10px;">ุฑูู ุงูุฌููุณ: ____________________</p>
      <p class="teacher-name" id="teacherHeader">ูุนูู ุงููุงุฏุฉ: </p>
    </div>

    <p style="font-size: 18px; font-weight: bold;" id="academicYearDisplay">
      - ููุฒูุงุก 1 ุฃูู ุซุงููู ุงูุนุงู ุงูุฏุฑุงุณู ุงููุตู ุงูุฏุฑุงุณู ุงูุฃูู
    </p>
    <p id="examDetails"></p>
    <hr style="margin: 20px 0; border: 1px solid #000;">

    <div class="grade-container" style="display:none;">
      <div class="grade-label">ุงูุฏุฑุฌุฉ ุงููููุฉ</div>
      <div class="split-box">
        <div class="upper"></div>
        <div class="lower" id="totalExamScore">0</div>
      </div>
    </div>

    <div id="questionsCount">
      <p>ุนุฏุฏ ุฃุณุฆูุฉ ุงูุงุฎุชูุงุฑ ุงููุชุนุฏุฏ: <span id="mcqCount">0</span></p>
      <p>ุนุฏุฏ ุฃุณุฆูุฉ ุงูุตุญ ูุงูุฎุทุฃ: <span id="tfCount">0</span></p>
      <p>ุนุฏุฏ ุงูุฃุณุฆูุฉ ุงูููุงููุฉ: <span id="essayCount">0</span></p>
      <p>ุงูุนุฏุฏ ุงูููู ููุฃุณุฆูุฉ: <span id="totalQuestionsCount">0</span></p>
    </div>

    <div class="mcq-section" style="display:none;">
      <h3></h3>
      <ol id="mcqList" style="margin: 0; padding: 0 20px;"></ol>
    </div>
    <div class="tf-section" style="display:none;">
      <h3></h3>
      <ol id="tfList"></ol>
    </div>
    <div class="essay-section" style="display:none;">
      <h3></h3>
      <ol id="essayList"></ol>
    </div>
  </div>
<script>
    window.addEventListener("DOMContentLoaded", () => {
      const newUrl = window.location.origin + window.location.pathname;
      window.history.replaceState({}, '', newUrl);
    });
  </script>
<script>
  document.addEventListener('contextmenu', e => e.preventDefault()); // ูููุน ููู ูููู
  document.onkeydown = function(e) {
    if (e.keyCode == 123 || // F12
        (e.ctrlKey && e.shiftKey && e.keyCode == 'I'.charCodeAt(0)) || // Ctrl+Shift+I
        (e.ctrlKey && e.keyCode == 'U'.charCodeAt(0)) || // Ctrl+U
        (e.ctrlKey && e.keyCode == 'S'.charCodeAt(0)) // Ctrl+S
    ) {
      e.preventDefault();
      return false;
    }
  };
</script>
</body>
</html>
